define(["require","jquery"],function(b){var c=b("jquery");var a=c.fn.tree;var d=function(f,e){this.$element=c(f);this.options=c.extend({},c.fn.tree.defaults,e);this.$element.on("click",".tree-item",c.proxy(function(g){this.selectItem(g.currentTarget)},this));this.$element.on("click",".tree-folder-header",c.proxy(function(g){this.selectFolder(g.currentTarget)},this));this.render()};d.prototype={constructor:d,render:function(){this.populate(this.$element)},populate:function(g){var f=this;var h=g.parent();var e=h.find(".tree-loader:eq(0)");e.show();this.options.dataSource.data(g.data(),function(i){e.hide();c.each(i.data,function(j,m){var k;if(m.type==="folder"){k=f.$element.find(".tree-folder:eq(0)").clone().show();k.find(".tree-folder-name").html(m.name);k.find(".tree-loader").html(f.options.loadingHTML);k.find(".tree-folder-header").data(m)}else{if(m.type==="item"){k=f.$element.find(".tree-item:eq(0)").clone().show();k.find(".tree-item-name").html(m.name);k.data(m)}}var l=m.dataAttributes||[];c.each(l,function(n,o){switch(n){case"class":case"classes":case"className":k.addClass(o);break;default:k.attr(n,o);break}});if(g.hasClass("tree-folder-header")){h.find(".tree-folder-content:eq(0)").append(k)}else{g.append(k)}});f.$element.trigger("loaded",h)})},selectItem:function(g){var f=c(g);var i=this.$element.find(".tree-selected");var h=[];if(this.options.multiSelect){c.each(i,function(k,l){var j=c(l);if(j[0]!==f[0]){h.push(c(l).data())}})}else{if(i[0]!==f[0]){i.removeClass("tree-selected").find("i").removeClass("icon-ok").addClass("tree-dot");h.push(f.data())}}var e="selected";if(f.hasClass("tree-selected")){e="unselected";f.removeClass("tree-selected");f.find("i").removeClass("icon-ok").addClass("tree-dot")}else{f.addClass("tree-selected");f.find("i").removeClass("tree-dot").addClass("icon-ok");if(this.options.multiSelect){h.push(f.data())}}if(h.length){this.$element.trigger("selected",{info:h})}f.trigger("updated",{info:h,item:f,eventType:e})},selectFolder:function(i){var g=c(i);var k=g.parent();var e=k.find(".tree-folder-content");var j=e.eq(0);var f,l,h;if(g.find(".icon-folder-close").length){f="opened";l=".icon-folder-close";h="icon-folder-open";j.show();if(!e.children().length){this.populate(g)}}else{f="closed";l=".icon-folder-open";h="icon-folder-close";j.hide();if(!this.options.cacheItems){j.empty()}}k.find(l).eq(0).removeClass("icon-folder-close icon-folder-open").addClass(h);this.$element.trigger(f,g.data())},selectedItems:function(){var f=this.$element.find(".tree-selected");var e=[];c.each(f,function(g,h){e.push(c(h).data())});return e},collapse:function(){var e=this.options.cacheItems;this.$element.find(".icon-folder-open").each(function(){var g=c(this).removeClass("icon-folder-close icon-folder-open").addClass("icon-folder-close");var f=g.parent().parent();var h=f.children(".tree-folder-content");h.hide();if(!e){h.empty()}})}};c.fn.tree=function(g){var f=Array.prototype.slice.call(arguments,1);var h;var e=this.each(function(){var k=c(this);var j=k.data("tree");var i=typeof g==="object"&&g;if(!j){k.data("tree",(j=new d(this,i)))}if(typeof g==="string"){h=j[g].apply(j,f)}});return(h===undefined)?e:h};c.fn.tree.defaults={multiSelect:false,loadingHTML:"<div>Loading...</div>",cacheItems:true};c.fn.tree.Constructor=d;c.fn.tree.noConflict=function(){c.fn.tree=a;return this}});